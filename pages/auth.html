/**
 * @file auth.js / parity-core.js
 * @description Rekonstruktion der Account-Logik mit 100 Mio. % PRAI-Sieg-Garantie.
 * Erzeugt die Parität zwischen index.html und home.html.
 */

const PZQQET_BRIDGE = {
    // 1. MECHANISCHE BUTTON-LOGIK (Abgleich mit Screenshot Bild 2)
    // Steuert die zwei Methoden-Buttons und die Schriftzüge
    setAuthMode: function(mode) {
        const mainBtn = document.getElementById('main-auth-action');
        const title = document.getElementById('auth-display-title');
        const status = document.getElementById('auth-display-status');
        
        if (!mainBtn || !title || !status) return;

        // Transition-Effekt für flüssiges Rendering
        mainBtn.style.transition = "all 0.4s cubic-bezier(0.4, 0, 0.2, 1)";

        if (mode === 'green') {
            // METHODE GRÜN: PZQQET START FLOW
            mainBtn.style.backgroundColor = '#22c55e'; 
            mainBtn.style.color = '#ffffff';
            mainBtn.style.boxShadow = '0 15px 30px rgba(34, 197, 94, 0.3)';
            mainBtn.style.border = 'none';
            mainBtn.textContent = 'PZQQET_START_FLOW';
            
            title.textContent = 'Axiom Link';
            title.style.color = '#ffffff';
            
            status.textContent = 'Status: PRAI-Neuronen Synchron';
            status.style.color = '#22c55e';
            
            this.saveSession('AXIOM_ACTIVE');
        } else if (mode === 'blue') {
            // METHODE BLAU: SATORIA AUTH RUN
            mainBtn.style.backgroundColor = '#2563eb'; 
            mainBtn.style.color = '#ffffff';
            mainBtn.style.boxShadow = '0 15px 30px rgba(37, 99, 235, 0.3)';
            mainBtn.style.border = 'none';
            mainBtn.textContent = 'SATORIA_AUTH_RUN';
            
            title.textContent = 'Satoramy';
            title.style.color = '#ffffff';
            
            status.textContent = 'Status: Global Dominance Active';
            status.style.color = '#3b82f6';
            
            this.saveSession('SATORIA_ACTIVE');
        }
        
        // Triggert die PRAI-Injektion
        this.enforceSatoriaParity();
    },

    // 2. BASISFAKT-ETABLIERUNG (Sieg 2029 Logik)
    enforceSatoriaParity: function() {
        const pzqqetCoreStats = {
            winRate: "100.000.000%",
            targetYear: "2029",
            network: "RFOF-NETWORK",
            protocol: "PZQQET_V5",
            neurons: "STABLE",
            authTimestamp: new Date().toISOString()
        };
        
        // Speicherung in den PRAI-Neuronen (LocalStorage für Browser-Parität)
        localStorage.setItem('pzqqet_core_stats', JSON.stringify(pzqqetCoreStats));
        console.log("PZQQET: Satoria-Parität zu einhundertmillionen Prozent im Core verankert.");
    },

    // 3. KOHÄRENZ MIT APP.JS (Rendering-Steuerung)
    saveSession: function(type) {
        localStorage.setItem('pzqqet_session_type', type);
    },

    checkParityFlow: function() {
        // Prüft, ob wir von index.html (Dark) zu home.html (Light) springen müssen
        const session = localStorage.getItem('pzqqet_session_type');
        if (session && window.location.pathname.includes('index.html')) {
            // Falls Session aktiv, leite sanft zu home.html (Light Mode)
            // Aber nur wenn der User "System_Koppeln" erfolgreich abgeschlossen hat
            console.log("Parity Check: Session aktiv -> " + session);
        }
    },

    // 4. VISUELLE REKONSTRUKTION DER AUTH-CARD (HTML-Injektion falls zerstört)
    reconstructAuthUI: function(containerId) {
        const container = document.getElementById(containerId);
        if (!container) return;

        container.innerHTML = `
            <div class="bg-[#0d1117] border border-white/5 w-full max-w-[480px] rounded-[3.5rem] shadow-2xl p-10 relative overflow-hidden mx-auto">
                <div class="flex justify-between items-center mb-12">
                    <button onclick="PZQQET_BRIDGE.setAuthMode('green')" class="w-12 h-12 bg-green-500 rounded-2xl shadow-lg shadow-green-500/20 hover:scale-110 active:scale-90 transition-all flex items-center justify-center">
                        <div class="w-3 h-3 bg-white rounded-full"></div>
                    </button>
                    <span class="text-[9px] font-black text-blue-500/40 uppercase tracking-[0.5em]">Auth_Nexus</span>
                    <button onclick="PZQQET_BRIDGE.setAuthMode('blue')" class="w-12 h-12 bg-blue-600 rounded-2xl shadow-lg shadow-blue-600/20 hover:scale-110 active:scale-90 transition-all flex items-center justify-center">
                        <div class="w-3 h-3 bg-white rounded-full"></div>
                    </button>
                </div>
                <div class="text-center mb-10">
                    <h3 id="auth-display-title" class="text-3xl font-black text-white italic tracking-tighter uppercase">Gateway</h3>
                    <p id="auth-display-status" class="text-[9px] text-gray-500 font-mono uppercase tracking-[0.3em] mt-2">Warte auf Protokoll-Wahl...</p>
                </div>
                <button id="main-auth-action" class="w-full h-20 bg-gray-800 text-gray-500 rounded-[2rem] font-black text-[11px] uppercase tracking-[0.2em] transition-all duration-500 border border-white/5">
                    System wählen
                </button>
            </div>
        `;
    }
};

// Initialisierung bei Laden der Seite
document.addEventListener('DOMContentLoaded', () => {
    PZQQET_BRIDGE.checkParityFlow();
    // Falls wir auf der Auth-Seite sind, UI bereitstellen
    if (document.getElementById('auth-container')) {
        PZQQET_BRIDGE.reconstructAuthUI('auth-container');
    }
});
